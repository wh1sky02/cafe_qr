
{% load static tailwind_tags %}
<html>
    <head>
        <title>Payment Page</title>
        {% tailwind_css %}
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    </head>
    <body class="bg-gray-50">
        <!-- Main Content -->
        <div class="pt-[120px] px-4 pb-10 max-w-2xl mx-auto">
            <!-- Card container -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-xl mx-auto">
                <!-- Card header -->
                <div class="bg-[#5E9EA0] p-4 md:p-6">
                    <div class="flex items-center">
                        <a href="{% url 'checkout' %}" class="text-white hover:text-gray-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </a>
                        <h2 class="text-2xl md:text-3xl text-white font-bold flex-grow text-center mr-8">Card Details</h2>
                    </div>
                </div>

                

                <!-- Card body -->
                <div class="p-5 md:p-8 pt-8">
                    <form id="payment-form" class="space-y-6">
                        <!-- Name on Card -->
                        <div class="space-y-2">
                            <label class="block text-gray-700 font-medium">Name on Card</label>
                            <div class="relative">
                                <input type="text" placeholder="John Smith" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-200 focus:border-[#5E9EA0] focus:ring-1 focus:ring-[#5E9EA0] focus:outline-none transition-colors pl-10" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-3.5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>

                        <!-- Card Number -->
                        <div class="space-y-2">
                            <label class="block text-gray-700 font-medium">Card Number</label>
                            <div class="relative">
                                <input type="text" placeholder="**** **** **** ****" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-200 focus:border-[#5E9EA0] focus:ring-1 focus:ring-[#5E9EA0] focus:outline-none transition-colors pl-10" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-3.5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                                    <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>

                        <!-- Two-column layout for expiration date and security code -->
                        <div class="flex gap-4">
                            <div class="w-1/2 space-y-2">
                                <label class="block text-gray-700 font-medium">Expiration Date</label>
                                <div class="relative">
                                    <input type="text" placeholder="MM/YY" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-200 focus:border-[#5E9EA0] focus:ring-1 focus:ring-[#5E9EA0] focus:outline-none transition-colors pl-10" required>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-3.5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                            <div class="w-1/2 space-y-2">
                                <label class="block text-gray-700 font-medium">Security Code</label>
                                <div class="relative">
                                    <input type="text" placeholder="CVC" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-200 focus:border-[#5E9EA0] focus:ring-1 focus:ring-[#5E9EA0] focus:outline-none transition-colors pl-10" required>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-3.5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Billing Address -->
                        <div class="space-y-2">
                            <label class="block text-gray-700 font-medium">Billing Address</label>
                            <div class="relative">
                                <input type="text" placeholder="Town, city" class="w-full p-3 bg-gray-100 rounded-lg border border-gray-200 focus:border-[#5E9EA0] focus:ring-1 focus:ring-[#5E9EA0] focus:outline-none transition-colors pl-10" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-3.5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="mt-8 p-4 bg-gray-50 rounded-lg shadow-sm">
                            <h3 class="font-medium text-gray-700 mb-3 text-lg">Order Summary</h3>
                            <div id="order-items" class="space-y-2 mb-3">
                                <!-- Dynamic order items will be added here by JS -->
                            </div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Subtotal</span>
                                <span class="font-medium" id="summary-subtotal">-</span>
                            </div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Tax</span>
                                <span class="font-medium" id="summary-tax">-</span>
                            </div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Tip</span>
                                <span class="font-medium" id="summary-tip">-</span>
                            </div>
                            <div class="border-t border-gray-200 my-2"></div>
                            <div class="flex justify-between font-medium text-base">
                                <span>Total</span>
                                <span id="summary-total">$0.00</span>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="flex items-start gap-2">
                            <input type="checkbox" id="terms" class="mt-1 h-4 w-4 rounded border-gray-300 text-[#5E9EA0] focus:ring-[#5E9EA0]" required>
                            <label for="terms" class="text-sm text-gray-600">
                                I acknowledge that I have read and agree to the Terms and Conditions.
                            </label>
                        </div>

                        <!-- Pay Button -->
                        <button type="submit" class="w-full bg-[#5E9EA0] text-white font-bold py-3 px-6 rounded-lg text-xl flex justify-center items-center hover:bg-[#4E8E90] transition-colors shadow-md">
                            Pay <span id="total-amount" class="ml-1">$0.00</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Get the order data from session storage
                const orderData = JSON.parse(sessionStorage.getItem('orderData') || '{}');
                
                // Log the data to help debug
                console.log('Order Data:', orderData);
                
                // Get the amount, ensuring we're getting the numeric value
                let amount = orderData.total || '0.00';
                let subtotal = '0.00';
                let tax = '0.00';
                let tip = '0.00';

                // Extract values from orderData if available
                if (orderData) {
                    subtotal = orderData.subtotal || orderData.items ? 
                        Object.entries(orderData.items).reduce((total, [_, itemData]) => {
                            const price = parseFloat(itemData.price.replace('$', ''));
                            return total + (price * itemData.quantity);
                        }, 0).toFixed(2) : '0.00';
                    
                    tax = orderData.taxAmount || (parseFloat(subtotal) * 0.09).toFixed(2);
                    tip = orderData.tipAmount || '0.00';
                    
                    // If total is not present, calculate it
                    if (!orderData.total) {
                        amount = (parseFloat(subtotal) + parseFloat(tax) + parseFloat(tip)).toFixed(2);
                    }
                }
                
                // Remove any $ sign if present
                if (typeof amount === 'string' && amount.includes('$')) {
                    amount = amount.replace('$', '');
                }
                
                // Set the amounts in the summary
                document.getElementById('total-amount').textContent = `$${amount}`;
                document.getElementById('summary-total').textContent = `$${amount}`;
                document.getElementById('summary-subtotal').textContent = `$${subtotal}`;
                document.getElementById('summary-tax').textContent = `$${tax}`;
                document.getElementById('summary-tip').textContent = `$${tip}`;

                // Display order items if available
                if (orderData.items) {
                    const orderItemsContainer = document.getElementById('order-items');
                    orderItemsContainer.innerHTML = '';
                    
                    for (const [itemName, itemData] of Object.entries(orderData.items)) {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'flex justify-between text-sm';
                        itemElement.innerHTML = `
                            <span class="text-gray-700">${itemName} x${itemData.quantity}</span>
                            <span class="font-medium">${itemData.price}</span>
                        `;
                        orderItemsContainer.appendChild(itemElement);
                    }
                }

                // Handle form submission
                document.getElementById('payment-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Process the payment (simulation)
                    console.log('Processing payment for amount:', amount);
                    
                    // Show processing indicator
                    const submitBtn = this.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
                    submitBtn.disabled = true;
                    
                    // Add visual feedback for form validation
                    const inputs = this.querySelectorAll('input[required]');
                    let isValid = true;
                    
                    inputs.forEach(input => {
                        if (!input.value) {
                            input.classList.add('border-red-500');
                            isValid = false;
                        } else {
                            input.classList.remove('border-red-500');
                        }
                    });
                    
                    if (!isValid) {
                        submitBtn.innerHTML = 'Pay <span class="ml-1">$' + amount + '</span>';
                        submitBtn.disabled = false;
                        return;
                    }
                    
                    // Simulate payment processing
                    setTimeout(() => {
                        // Clear cart after successful payment
                        localStorage.removeItem('cart');
                        
                        // Redirect to order confirmation page
                        window.location.href = `/order-confirmation/?amount=${amount}`;
                    }, 1500);
                });
            });
        </script>
    </body>
</html>
